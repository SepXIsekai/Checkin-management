<div class="flex items-center justify-between border-b border-slate-200 bg-white/80 px-8 py-4 backdrop-blur-md">
  <div class="flex flex-col items-start">
    <h1 class="text-xl font-bold"><%= @checkin_form.title %></h1>
    <p class="text-sm text-gray-400 font-medium"><%= @course.name %> • <%= @course.code %> • Year <%= @course.year %> • Semester <%= @course.semester %></p>
  </div>
  <div class="flex gap-3">
    <% is_open = @checkin_form.open? %>
    <div class="flex items-center gap-2 px-4 py-2 rounded-full border
    <%= is_open ? 'bg-green-50 border-green-100' : 'bg-slate-50 border-slate-200' %>">
      <span class="relative flex h-2.5 w-2.5">
        <% if is_open %>
          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
          <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-green-500"></span>
        <% else %>
          <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-slate-400"></span>
        <% end %>
      </span>
      <span class="px-3 py-1 text-sm font-bold
        <%= is_open ? 'text-green-800' : 'text-slate-700' %>">
        <%= is_open ? "Open" : "Closed" %>
      </span>
    </div>
    <% is_online = @checkin_form.online? %>
    <div class="flex items-center gap-2 px-4 py-2 rounded-full border
    <%= is_online ? 'bg-blue-50 border-blue-100' : 'bg-orange-50 border-orange-100' %>">
      <span class="relative flex h-2.5 w-2.5">
        <% if is_online %>
          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
          <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-blue-500"></span>
        <% else %>
          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-orange-400 opacity-75"></span>
          <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-orange-500"></span>
        <% end %>
      </span>
      <span class="px-3 py-1 text-sm font-bold
    <%= is_online ? 'text-blue-800' : 'text-orange-800' %>">
        <% if is_online %>
          Online
        <% else %>
          Onsite (Within <%= @checkin_form.radius %> m)
        <% end %>
      </span>
    </div>
  </div>
</div>
<div class="m-10 h-[calc(90vh-120px)]">
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 h-full min-h-0">
    <div class="bg-white rounded-2xl shadow p-12 flex flex-col justify-center"
     data-controller="qr-refresh"
     data-qr-refresh-url-value="<%= qr_code_course_checkin_form_path(@course, @checkin_form) %>">
      <div class="flex justify-center mb-8"
       data-qr-refresh-target="qrcode">
        <%= @checkin_form.qr_code_svg(@host).html_safe %>
      </div>
      <p class="text-sm text-slate-500 break-all text-center mb-6"
     data-qr-refresh-target="url">
        <%= @checkin_form.checkin_url(@host) %>
      </p>
      <%= link_to "Full Screen",
      fullscreen_course_checkin_form_path(@course, @checkin_form),
      target: "_blank",
      class: "w-full flex items-center justify-center bg-[#261ce6] text-white py-3 rounded-xl hover:bg-[#1a14a3] transition font-semibold shadow-md hover:shadow-lg active:scale-[0.98]" %>
    </div>
    <div class="flex flex-col gap-6 h-full min-h-0">
      <div class="bg-white rounded-2xl shadow p-6 space-y-4">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold">Check-in Summary</h2>
        </div>
        <% if @checkin_form.onsite? %>
          <div class="text-sm text-slate-600">
            <span class="font-medium text-slate-500">Location:</span>
            <%= @checkin_form.latitude %>,
            <%= @checkin_form.longitude %>
          </div>
        <% end %>
        <div class="text-sm">
          <span class="font-medium text-slate-500">Checked-in:</span>
          <span class="font-bold text-[#261ce6] text-base">
            <%= @checkin_form.attendances.count %> students
          </span>
        </div>
        <div class="pt-4 border-t border-slate-300 flex flex-wrap gap-3">
          <%= button_to @checkin_form.active? ? "Close" : "Open",
      toggle_course_checkin_form_path(@course, @checkin_form),
      method: :patch,
      class: @checkin_form.active? ?
        "bg-red-600 text-white px-4 py-2 rounded-xl hover:bg-red-700 transition font-medium shadow-sm cursor-pointer" :
        "bg-green-600 text-white px-4 py-2 rounded-xl hover:bg-green-700 transition font-medium shadow-sm cursor-pointer" %>
          <%= button_to "Delete",
      course_checkin_form_path(@course, @checkin_form),
      method: :delete,
      data: { turbo_confirm: "ยืนยันการลบฟอร์มนี้ใช่ไหม?" },
      class: "bg-slate-200 text-slate-700 px-4 py-2 rounded-xl hover:bg-slate-300 transition font-medium cursor-pointer" %>
        </div>
      </div>
      <div class="flex flex-col flex-1 min-h-0">
        <div class="flex items-center gap-2">
          <span class="relative flex h-3 w-3">
            <% if is_open %>
              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
              <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
            <% else %>
              <span class="relative inline-flex rounded-full h-3 w-3 bg-slate-400"></span>
            <% end %>
          </span>
          <h2 class="text-lg font-semibold">Recent Check-ins</h2>
        </div>
        <% if @checkin_form.attendances.any? %>
          <div class="flex-1 overflow-y-auto space-y-3 py-4 pr-2 min-h-0">
            <% @checkin_form.attendances.order(checked_at: :desc).each do |attendance| %>
              <div class="bg-white border border-slate-100 rounded-2xl p-4 flex items-center gap-4 shadow-sm hover:shadow-md transition">
                <div class="size-10 rounded-full bg-[#261ce6] flex items-center justify-center text-xs font-bold text-white">
                  <%= attendance.name.to_s.first(2).upcase %>
                </div>
                <div class="flex-1 min-w-0">
                  <p class="text-base font-bold text-slate-800 truncate">
                    <%= attendance.name %>
                  </p>
                  <p class="text-[10px] text-slate-400 font-bold uppercase">
                    On-Time • <%= time_ago_in_words(attendance.checked_at) %> ago
                  </p>
                </div>
                <%= image_tag "backoffice/check-circle-green-icon.svg",
                  class: "w-7 h-7" %>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="flex-1 flex items-center justify-center text-slate-400">
            No students checked in yet
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
